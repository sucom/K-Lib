/** @license K-Lib | (c) Kumararaja <sucom.kumar@gmail.com> | License (MIT) */
!function(){for(var e,t=function(){},a=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],n=a.length,i=window.console=window.console||{};n--;)e=a[n],i[e]||(i[e]=t);"none"in window||(window.none=""),"noop"in window||(window.noop=function(){})}();var isKHashRouteOn=!1;!function(){function __renderView(e,t){var a,n=klib.setElIdIfNot(e);return a=t&&!$.isEmptyObject(t)?klib.render("#"+n,t):klib.render("#"+n)}var win=this,klib=function(e){return e instanceof klib?e:this instanceof klib?void 0:new klib(e)};win.klib=klib,klib.VERSION="2.0.0";var isById=document.getElementById,isByName=document.all;klib.isIE=isByName?!0:!1,klib.isNonIE=isById&&!isByName?!0:!1,klib.noop=function(){},klib.debug=!1,klib["debugger"]={on:function(){klib.debug=!0},off:function(){klib.debug=!1},toggle:function(){klib.debug=!klib.debug}},klib.cOut=function(e,t){klib.debug&&console[e]&&console[e](t)},klib.console={clear:function(){console.clear()},assert:function(e){klib.cOut("assert",e)},count:function(e){klib.cOut("count",e)},debug:function(e){klib.cOut("debug",e)},dir:function(e){klib.cOut("dir",e)},dirxml:function(e){klib.cOut("dirxml",e)},error:function(e){klib.cOut("error",e)},exception:function(e){klib.cOut("exception",e)},group:function(e){klib.cOut("group",e)},groupCollapsed:function(e){klib.cOut("groupCollapsed",e)},groupEnd:function(e){klib.cOut("groupEnd",e)},info:function(e){klib.cOut("info",e)},log:function(e){klib.cOut("log",e)},markTimeline:function(e){klib.cOut("markTimeline",e)},profile:function(e){klib.cOut("profile",e)},profileEnd:function(e){klib.cOut("profileEnd",e)},table:function(e){klib.cOut("table",e)},time:function(e){klib.cOut("time",e)},timeEnd:function(e){klib.cOut("timeEnd",e)},timeStamp:function(e){klib.cOut("timeStamp",e)},trace:function(e){klib.cOut("trace",e)},warn:function(e){klib.cOut("warn",e)}},klib._initWindowOnHashChange=function(){"onhashchange"in window&&(isKHashRouteOn=!0,window.onhashchange=function(e){var t=window.location.hash;t?klib.route(t):klib.routesOptions.defaultPageRoute&&klib.route(klib.routesOptions.defaultPageRoute)})},klib._stopWindowOnHashChange=function(){window.onhashchange=void 0},String.trim||(String.prototype.trim=function(e){return e=e||"\\s+",this.replace(new RegExp("^"+e+"|"+e+"$","g"),"")}),String.trimLeft||(String.prototype.trimLeft=function(e){return this.replace(new RegExp("^"+(e||"\\s+"),"g"),"")}),String.trimRight||(String.prototype.trimRight=function(e){return this.replace(new RegExp((e||"\\s+")+"$","g"),"")}),String.isBlank||(String.prototype.isBlank=function(){return""==this.trim()}),String.ifBlank||(String.prototype.ifBlank=function(e){return e=e||"",this.isBlank()?(""+e).trim():this.trim()}),String.isNumber||(String.prototype.isNumber=function(){return 0==(""+this).replace(/[0-9.]/g,"").trim().length}),String.normalizeStr||(String.prototype.normalizeStr=function(){return this.trim().replace(/\s+/g," ")}),String.beginsWith||(String.prototype.beginsWith=function(e,t){t=t?"i":"";var a=new RegExp("^"+e,t);return this.normalizeStr().match(a)?!0:!1}),String.beginsWithIgnoreCase||(String.prototype.beginsWithIgnoreCase=function(e){var t=new RegExp("^"+e,"i");return this.normalizeStr().match(t)?!0:!1}),String.endsWith||(String.prototype.endsWith=function(e,t){t=t?"gi":"g";var a=new RegExp(e+"$",t);return this.normalizeStr().match(a)?!0:!1}),String.endsWithIgnoreCase||(String.prototype.endsWithIgnoreCase=function(e,t){var a=new RegExp(e+"$","gi");return this.normalizeStr().match(a)?!0:!1}),String.contains||(String.prototype.contains=function(e,t){t=t?"gi":"g";var a=new RegExp(""+e,t);return a.test(this)}),String.equals||(String.prototype.equals=function(e){return this==e}),String.equalsIgnoreCase||(String.prototype.equalsIgnoreCase=function(e){return String(this.toLowerCase())==String(e).toLowerCase()}),String.toProperCase||(String.prototype.toProperCase=function(e){return("undefined"==typeof e||e?this.normalizeStr():this).toLowerCase().replace(/^(.)|\s(.)/g,function(e){return e.toUpperCase()})}),klib.toJSON=function(str){var thisStr;return _.isString(str)&&(thisStr=str.trim(),thisStr.contains(":")&&!thisStr.contains(",")&&thisStr.contains(";")&&(thisStr=thisStr.replace(/\;/g,",")),thisStr.beginsWith("{")||thisStr.beginsWith("\\[")?thisStr.beginsWith("{")&&!thisStr.contains(":")&&thisStr.contains("=")&&(thisStr=""+thisStr.replace(/=/g,":")):thisStr=thisStr.contains(":")?"{"+thisStr+"}":thisStr.contains("=")?"{"+thisStr.replace(/=/g,":")+"}":"["+thisStr+"]"),!_.isString(str)&&_.isObject(str)?str:klib.isBlank(str)?null:eval("("+thisStr+")")},String.toJSON||(String.prototype.toJSON=function(){return klib.toJSON(this)}),String.toBoolean||(String.prototype.toBoolean=function(){var e=!0;switch((""+this).trim().toLowerCase()){case"":case"0":case"-0":case"nan":case"null":case"false":case"undefined":e=!1}return e&&(e=!(""+this).trim().beginsWith("-")),e}),Boolean.toValue||(Boolean.prototype.toValue=function(e,t){return"undefined"==typeof e&&(e=!0),"undefined"==typeof t&&(t=!1),this.valueOf()?e:t}),Boolean.toHtml||(Boolean.prototype.toHtml=function(e,t){return $(this.valueOf()?e:t).html()}),String.pad||(String.prototype.pad=function(e,t,a){for(var n="",i=0;e>i;i++)n+=t;return(0===a||2===a?n:"")+this+(1===a||2===a?n:"")}),klib.lastSplitResult=[],klib.getOnSplit=function(e,t,a){return klib.lastSplitResult=e.split(t),klib.getOnLastSplit(a)},klib.getOnLastSplit=function(e){return 0>e?_.last(klib.lastSplitResult):klib.lastSplitResult[e]},klib.isBlank=klib.isEmpty=function(e){var t=!0;if(e)switch(!0){case _.isString(e):t=0==e.trim().length;break;case _.isArray(e):case _.isObject(e):t=_.isEmpty(e)}return t},klib.isNumber=function(e){return 0==(""+e).replace(/[0-9.]/g,"").trim().length},klib.toBoolean=function(e){var t=!0;switch((""+e).trim().toLowerCase()){case"":case"0":case"-0":case"nan":case"null":case"false":case"undefined":t=!1}return t},klib.toInt=function(e){return e=(""+e).replace(/[^+-0123456789.]/g,""),e=klib.isBlank(e)?"0":e.indexOf(".")>=0?e.substring(0,e.indexOf(".")):e,parseInt(1*e,10)},klib.toFloat=function(e){return e=(""+e).replace(/[^+-0123456789.]/g,""),e=klib.isBlank(e)?"0":e,parseFloat(1*e)},klib.toStr=function(e){var t=""+e;return _.isObject(e)&&(t=JSON.stringify(e)),t},klib.dotToX=function(e,t){return e.replace(/\./g,t)},klib.dotToCamelCase=function(e){var t=e.replace(/\./g," ").toProperCase().replace(/ /g,"");return t[0].toLowerCase()+t.substring(1)},klib.dotToTitleCase=function(e){return e.replace(/\./g," ").toProperCase().replace(/ /g,"")},klib.toDottedPath=function(e){return(e||"").replace(/]/g,"").replace(/(\[)|(\\)|(\/)/g,".").replace(/(\.+)/g,".").trim("\\.")},klib.ifBlank=klib.ifEmpty=klib.ifNull=function(e,t){return t=(""+(t||"")).trim(),klib.isBlank(e)?t:(""+e).trim()},klib.now=function(){return""+(new Date).getTime()},klib.year=function(e){return e=e||0,(new Date).getFullYear()+klib.toInt(e)},klib.range=function(e){var t=e.toUpperCase().split(".."),a=""+t[0],n=""+t[1],i="1";n.indexOf(":")>0&&(n=""+t[1].split(":")[0],i=""+t[1].split(":")[1]),a.indexOf("Y")>=0&&(a=klib.year(a.split(/[^0-9+-]/)[1])),n.indexOf("Y")>=0&&(n=klib.year(n.split(/[^0-9+-]/)[1]));var l=klib.toInt(a),r=klib.toInt(n),o=klib.toInt(i);return a>n?_.range(r,l+1,o).reverse():_.range(l,r+1,o)},klib.checkAndPreventKey=function(e,t){t||(t="");var a=t.indexOf("+shift")>=0,n=""+e.keyCode,i=t.pad(1,",",2).indexOf(n.pad(1,",",2))>=0&&(a?e.shiftKey?!0:!1:e.shiftKey?!1:!0);return i&&e.preventDefault(),i},klib._trackAndControlKey=function(e){var t=e.currentTarget,a=(""+$(t).data("disableKeys")).toLowerCase();klib.checkAndPreventKey(e,a);var n=!klib.isBlank((""+$(t).data("focusNext")).replace(/undefined/,"").toLowerCase()),i=!klib.isBlank((""+$(t).data("focusBack")).replace(/undefined/,"").toLowerCase());n&&klib.checkAndPreventKey(e,"9")&&$($(t).data("focusNext")).get(0).focus(),i&&klib.checkAndPreventKey(e,"9,+shift")&&$($(t).data("focusBack")).get(0).focus()},klib.initKeyTracking=function(){var e=arguments.length?arguments[0]:"[data-disable-keys],[data-focus-next],[data-focus-back]";$(e).each(function(e,t){$(t).keydown(klib._trackAndControlKey)})},klib.getDocObj=function(e){var t="object"==typeof e?e:(e.beginsWith("#")?"":"#")+e;return $(t).get(0)},klib.getDocObjs=function(e){var t=(e.beginsWith("#")?"":"#")+e;return $(t).get()},klib.setFocus=function(e,t){var a=klib.getDocObj(e);a&&(a.focus(),t&&a.select())},klib.isElementExist=function(e){return!$.isEmptyObject($(e).get())},klib.swapObjClass=function(e,t,a){$(e).removeClass(t),$(e).addClass(a)},klib.docObjValue=function(e,t){var a=klib.getDocObj(e),n="";return a&&(n=a.value,2===arguments.length&&(a.value=t)),n},klib.optionSelectedIndex=function(e,t){var a=-1,n=klib.getDocObj(e);return n&&(a=n.selectedIndex,2===arguments.length&&(n.selectedIndex=t)),a},klib.optionIndexOfValue=function(e,t){var a=-1,n=klib.getDocObj(e);if(n)for(var i=0;i<n.length;i++)if((""+t).equalsIgnoreCase(n.options[i].value)){a=i;break}return a},klib.optionIndexOfText=function(e,t){var a=-1,n=klib.getDocObj(e);if(n)for(var i=0;i<n.length;i++)if(t.equalsIgnoreCase(n.options[i].text)){a=i;break}return a},klib.optionIndexOfValueBeginsWith=function(e,t){var a=-1,n=klib.getDocObj(e);if(n)for(var i=0;i<n.length;i++)if(n.options[i].value.beginsWith(t,"i")){a=i;break}return a},klib.optionsSelectedValues=function(e,t){return e=(e.beginsWith("#")?"":"#")+e,t=t||",",$.map($(e+" option:selected"),function(e){return e.value}).join(t)},klib.optionsSelectedTexts=function(e,t){return e=(e.beginsWith("#")?"":"#")+e,t=t||",",$.map($(e+" option:selected"),function(e){return e.text}).join(t)},klib.optionValueOfIndex=function(e,t){var a="",n=klib.getDocObj(e);return n&&t>=0&&t<n.length&&(a=n.options[t].value),a},klib.optionTextOfIndex=function(e,t){var a="",n=klib.getDocObj(e);return n&&t>=0&&t<n.length&&(a=n.options[t].text),a},klib.selectOptionForValue=function(e,t){var a=-1,n=klib.getDocObj(e);return n&&(a=klib.optionIndexOfValue(e,t),n.selectedIndex=a),a},klib.selectOptionForValueBeginsWith=function(e,t){var a=-1,n=klib.getDocObj(e);return n&&(a=klib.optionIndexOfValueBeginsWith(e,t),n.selectedIndex=a),a},klib.selectOptionsForValues=function(e,t,a){a=a||",",t=(a+t+a).toLowerCase();var n,i=klib.getDocObj(e);if(i)for(var l=0;l<i.length;l++)n=(a+i.options[l].value+a).toLowerCase(),i.options[l].selected=t.indexOf(n)>=0},klib.selectOptionForText=function(e,t){var a=-1,n=klib.getDocObj(e);return n&&(a=klib.optionIndexOfText(e,t),n.selectedIndex=a),a},klib.selectOptionsAll=function(e){var t=klib.getDocObj(e);if(t)for(var a=0;a<t.length;a++)t.options[a].selected=!0},klib.selectOptionsNone=function(e){var t=klib.getDocObj(e);if(t)for(var a=0;a<t.length;a++)t.options[a].selected=!1},klib.optionsReduceToLength=function(e,t){t=t||0;var a=klib.getDocObj(e);a&&(klib.selectOptionsNone(e),a.length=t)},klib.optionsRemoveAll=function(e){klib.optionsReduceToLength(e,0)},klib.optionRemoveForIndex=function(e,t){e=(e.beginsWith("#")?"":"#")+e;var a=klib.getDocObj(e);a&&((""+t).equalsIgnoreCase("first")&&(t=0),(""+t).equalsIgnoreCase("last")&&(t=a.length-1),a.remove(t))},klib.optionRemoveForValue=function(e,t){klib.optionRemoveForIndex(e,klib.optionIndexOfValue(e,t))},klib.optionRemoveForText=function(e,t){klib.optionRemoveForIndex(e,klib.optionIndexOfText(e,t))},klib.optionRemoveForValueBeginsWith=function(e,t){klib.optionRemoveForIndex(e,klib.optionIndexOfValueBeginsWith(e,t))},klib.optionAppend=function(e,t,a,n){var i=-1,l=klib.getDocObj(e);if(l)if("undefined"==typeof n){var r=l.length;l.length=r+1,l.options[r].value=t,l.options[r].text=a,i=r}else $(l).find("option").eq(n).before('<option value="'+t+'">'+a+"</option>"),i=n;return i},klib.optionsLoad=function(e,t,a,n){var i=["","key","value"];if(a=a||0,n=n||0,_.isString(t)&&t.indexOf("..")>0&&(t=klib.range(t)),a>=0&&klib.optionsReduceToLength(e,a),_.isArray(t))_.each(t,function(t){klib.optionAppend(e,t,t)});else if(n>0){var l=[];for(var r in t)l.push({key:r,value:t[r]});var o=_.sortBy(l,i[n]);_.each(o,function(t){klib.optionAppend(e,t.key,t.value)})}else _.each(t,function(t,a){klib.optionAppend(e,a,t)})},klib.checkedState=function(e,t){var a=!1,n=klib.getDocObj(e);return n&&(a=n.checked,2===arguments.length&&(n.checked=t)),a},klib.isChecked=function(e,t){return $("input[name="+t+"]:checked",e).length>0},klib.radioSelectedValue=function(e,t){var a=$("input[name="+t+"]:checked",e).val();return a?a:""},klib.radioClearSelection=function(e,t){$("input[name="+t+"]:checked",e).attr("checked",!1)},klib.radioSelectForValue=function(e,t,a){$("input[name="+t+"]:radio",e).each(function(e){e.checked=e.value.equalsIgnoreCase(a)})},klib.checkboxCheckedValues=function(e,t,a){return a=a||",",$("input[name="+t+"]:checked",e).map(function(){return this.value}).get().join(a)},klib.sleep=function(e){var t=new Date;for(t.setTime(t.getTime()+1e3*e);(new Date).getTime()<t.getTime(););},klib.filterJSON=function(e,t){return $(e).filter(function(e,a){for(var n in t)if(!a[n].toString().match(t[n]))return null;return a})},klib.randomPassword=function(e){for(var t="9a8b77C8D9E8F7G6H5I4J3c6d5e4f32L3M4N5P6Qg2h3i4j5kV6W5X4Y3Z26m7n8p9q8r7s6t5u4v3w2x3y4z5A6BK7R8S9T8U7",a="",n=0;e>n;n++){var i=Math.floor(Math.random()*t.length);a+=t.charAt(i)}return a},klib.rand=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},klib.htmlEncode=function(e){return $("<div/>").text(e).html()},klib.htmlDecode=function(e){return $("<div/>").html(e).text()},klib.parseKeyStr=function(e,t){return(t?e.toLowerCase():e).replace(/[^_0-9A-Za-z]/g,"")},klib.setObjProperty=function(e,t,a,n){t=""+t,n=n||!1;var i,l=e,r=t.split(/(?=[A-Z])/),o=$.trim(t.replace(/[0-9A-Za-z]/g,""));for(o&&""!=o&&(r=t.split(o[0]));r.length>1;)i=klib.parseKeyStr(r.shift(),n),""!=$.trim(i)&&("undefined"==typeof l[i]&&(l[i]={}),l=l[i]);return i=klib.parseKeyStr(r.shift(),n),l[i]=a,e},klib.getElValue=function(e){e=$(e).get(0);var t,a;switch(e.tagName.toUpperCase()){case"INPUT":switch(e.type.toLowerCase()){case"checkbox":a=$(e).data("unchecked"),t=e.checked?e.value:"undefined"==typeof a?"":a;break;case"radio":t=e.checked?e.value:"";break;default:t=$(e).val()}break;case"SELECT":t=$.map($(e).find("option:selected"),function(e){return e.value}).join(",");break;case"TEXTAREA":t=$(e).val();break;default:t=$(e).html()}return t},klib.serializeDisabled=function(e){var t="";return $(e).find("[disabled][name]").each(function(){t+=(t?"&":"")+$(this).attr("name")+"="+klib.getElValue(this)}),t},klib.serializeForms=function(e,t){var a,n,i=$(e).serialize();return $(e).find("input:checkbox:enabled:not(:checked)[name]").each(function(){n=$(this).data("unchecked"),i+=(i?"&":"")+$(this).attr("name")+"="+("undefined"==typeof n?"":n)}),t&&(a=klib.serializeDisabled(e),i+=(i&&a?"&":"")+a),i},klib.queryStringToJson=function(e){var t={},a=e||location.search,n=(""+a).indexOf("?"),i=(""+a).indexOf("&");return a&&a.length>0&&n>=0&&(0==n||i>n)&&(a=a.substring(n+1)),_.each(a.split("&"),function(e){e=e.split("="),e[0]&&(_.has(t,e[0])?(_.isArray(t[e[0]])||(t[e[0]]=[t[e[0]]]),t[e[0]].push(decodeURIComponent(e[1]||""))):t[e[0]]=decodeURIComponent(e[1]||""))}),t},$.fn.serializeUncheckedCheckboxes=function(e){var t,a,n,i,l="object"==typeof e,r=l?e:{},o=l&&!e?"":e;return $(this).find("input:checkbox:enabled:not(:checked)[name]").each(function(e,s){t=$(s),n=t.attr("name"),a=t.data("unchecked"),i="undefined"==typeof a?"":a,l?_.has(r,n)?(_.isArray(r[n])||(r[n]=[r[n]]),r[n].push(i)):r[n]=i:o+=(o?"&":"")+n+"="+i}),l?r:o},klib.serializeUncheckedCheckboxes=function(e,t){return $(e).serializeUncheckedCheckboxes(t)},$.fn.serializeFormToJSON=$.fn.serializeFormToObject=function(e,t,a){var n,i,l=this.serializeArray(),r="object"==typeof e?e:{},o="boolean"==typeof e?e:t||!1,s=$(this).data("serializeIgnorePrefix");return a&&(s=a),$.each(l,function(){n=s?this.name.replace(s,""):this.name,r=klib.setObjProperty(r,n,this.value,o)}),$(this).find("input:checkbox:enabled:not(:checked)").each(function(){n=$(this).attr("name"),n&&(i=$(this).data("unchecked"),s&&(n=n.replace(s,"")),i=""+("undefined"==typeof i?"":i),r=klib.setObjProperty(r,n,i,o))}),r},$.fn.serializeFormToSimpleJSON=$.fn.serializeFormToSimpleObject=function(e,t){var a,n,i,l,r=this.serializeArray(),o="object"==typeof e?e:{},s="boolean"==typeof e?e:t||!1;return $.each(r,function(){o[this.name]=this.value}),s&&$(this).find("[disabled][name]").each(function(){o[this.name]=klib.getElValue(this)}),$(this).find("input:checkbox:enabled:not(:checked)[name]").each(function(){i=$(this).attr("name"),l=$(this).data("unchecked"),l=""+("undefined"==typeof l?"":l),o[i]=l}),$(this).find("[data-to-json-group][name]").each(function(){a=this.name,n=$(this).data("toJsonGroup"),n&&(o[n]||(o[n]={}),o[n][a]=klib.getElValue(this))}),o},klib.serializeFormToSimpleJSON=klib.serializeFormToSimpleObject=function(e,t,a){return $(e).serializeFormToSimpleJSON(t,a)},klib.serializeFormToJSON=klib.serializeFormToObject=function(e,t,a,n){return $(e).serializeFormToJSON(t,a,n)},klib.find=klib.locate=function(obj,path){var tObj=obj,retValue;return"undefined"!=typeof eval("tObj."+path)&&(retValue=eval("tObj."+path)),retValue},klib.findSafe=klib.locateSafe=klib.valueOfKeyPath=function(e,t,a){for(var n=0,i=klib.toDottedPath(t).split("."),l=i.length;l>n;n++){if(!e||"undefined"==typeof e)return a;e=e[i[n]]}return"undefined"==typeof e?a:e},klib.has=klib.hasKey=function(obj,path){var tObj=obj;return"undefined"!=typeof eval("tObj."+path)},klib.hasIgnoreCase=klib.hasKeyIgnoreCase=function(e,t){var a="",n=e||{},i=""+klib.toDottedPath(t),l=klib.keysDottedAll(n);return l&&!_.isEmpty(l)&&_.some(l,function(e){var t=e.equalsIgnoreCase(i);return t||(t=e.beginsWithIgnoreCase(i+"."),t&&(e=e.slice(0,e.lastIndexOf(".")))),t&&(a=e),t}),a},klib.findIgnoreCase=function(e,t,a){var n=a,i=klib.hasIgnoreCase(e,t);return i&&(n=klib.findSafe(e,i,a)),n},klib.keysDottedAll=function(e){var t=klib.keysDotted(e);return t&&!_.isEmpty(t)&&(t=klib.toDottedPath(t.join(",")).split(",")),t},klib.keysDotted=function(e){e=e||{};var t,a,n,i=[];return function(e,l){if(l=l||"","object"!=typeof e)return!0;for(var r in e)n=l.substring(1),t=klib.isNumber(r)?"[":".",a=n&&"["==t?"]":"",arguments.callee(e[r],l+t+r+a)&&i.push(n+(n?t:"")+r+a);return!1}(e),i},klib.keysCamelCase=function(e){return _.map(klib.keysDotted(e),function(e){var t=e.replace(/\./g," ").toProperCase().replace(/ /g,"");return t[0].toLowerCase()+t.substring(1)})},klib.keysTitleCase=function(e){return _.map(klib.keysDotted(e),function(e){return e.replace(/\./g," ").toProperCase().replace(/ /g,"")})},klib.keys_=function(e){return _.map(klib.keysDotted(e),function(e){return e.replace(/\./g,"_")})},$.cachedScript=function(e,t){return t=$.extend(t||{},{dataType:"script",cache:!0,url:e}),$.ajax(t)},$.cachedStyle=function(e,t,a){return a=$.extend(a||{},{dataType:"text",cache:!0,url:t,success:function(t){$("head").append("<style id='"+e+"' type='text/css'>"+t+"</style>")}}),$.ajax(a)},klib.addScript=function(e,t){e=e.replace(/#/,""),klib.isElementExist("#kScriptsCotainer")||$("body").append("<div id='kScriptsCotainer' style='display:none' rel='Dynamic Scripts Container'></div>"),klib.isElementExist("#"+e)||$("#kScriptsCotainer").append("<script id='"+e+"' type='text/javascript' src='"+t+"'></script>")},klib.addStyle=function(e,t){e=e.replace(/#/,""),klib.isElementExist("#kStylesCotainer")||$("body").append("<div id='kStylesCotainer' style='display:none' rel='Dynamic Styles Container'></div>"),klib.isElementExist("#"+e)||$("#kStylesCotainer").append("<link id='"+e+"' rel='stylesheet' type='text/css' href='"+t+"'/>")},klib.loadScript=function(e,t,a,n){return e=e.replace(/#/,""),a=a||!1,n=n||[],klib.isBlank(t)||(a?klib.addScript(e,t):n.push($.cachedScript(t).done(function(e,t){}))),n},klib.loadStyle=function(e,t,a,n){return e=e.replace(/#/,""),a=a||!1,n=n||[],klib.isBlank(t)||(a?klib.addStyle(e,t):n.push($.cachedStyle(e,t).done(function(e,t){}))),n},klib.addTemplateScript=function(e,t,a){e=e.replace(/#/,""),klib.isElementExist("#kViewTemplateCotainer")||$("body").append("<div id='kViewTemplateCotainer' style='display:none' rel='Template Container'></div>"),$("#kViewTemplateCotainer").append("<script id='"+e+"' type='text/"+a+"'>"+t+"</script>")},klib.loadTemplate=function(e,t,a,n,i,l){if(e=e.replace(/#/g,""),t=t.ifBlank("inline").trim(),a=a||"x-template",n=n||"#DummyInlineTemplateContainer",i=i||[],klib.isElementExist("#"+e)){var r=$("#"+e);if(l)r.remove(),i=klib.loadTemplate(e,t,a,n,i,l);else if(klib.isBlank(r.html())){var o=""+r.attr("path");klib.isBlank(o)||(a=(r.attr("type")||"").ifBlank(a).toLowerCase().replace(/text\//gi,""),r.remove(),i=klib.loadTemplate(e,o,a,n,i,l))}}else if(t.equalsIgnoreCase("inline")||t.beginsWith("#")){var s=t.equalsIgnoreCase("inline")?n:t,d=$(s),c=d.html();klib.isBlank(c)||(klib.addTemplateScript(e,c,a),t.equalsIgnoreCase("inline")&&d.html(""))}else if(t.equalsIgnoreCase("none"));else if(!t.equalsIgnoreCase("script")){var u;u=l?$.ajax({url:t,cache:!1,dataType:"html",success:function(t){klib.addTemplateScript(e,t,a)},error:function(e,t,a){}}):$.get(t,function(t){klib.addTemplateScript(e,t,a)}),i.push(u)}return i},klib.loadTemplatesCollection=function(e,t){e=(e.beginsWith("#")?"":"#")+e;var a={};return klib.isElementExist(e)||(klib.isElementExist("#kViewTemplateCotainer")||$("body").append("<div id='kViewTemplateCotainer' style='display:none' rel='Template Container'></div>"),$("#kViewTemplateCotainer").append("<div id='"+e.substring(1)+"' style='display:none' rel='Template Collection Container'></div>"),$.ajax({url:t,cache:!0,dataType:"html",async:!1,success:function(t){$(e).html(t),$(e+" script").each(function(e,t){a[$(t).attr("id")]="script"})},error:function(e,t,a){}})),a},klib.urlParams=function(e){e=e||window.location.search||"",e=e.beginsWith("\\?")||e.indexOf("//")<7?e.substr(e.indexOf("?")+1):e;var t={};return e.replace(/([^&=]+)=?([^&]*)(?:&+|$)/g,function(e,a,n){(t[a]=t[a]||[]).push(decodeURIComponent(n))}),_.each(t,function(e,a){t[a]=_.isArray(e)&&1==e.length?e[0]:e}),t},klib.urlParam=function(e,t){return klib.urlParams(t)[e]},klib.getLocHash=function(){return window.location.hash||""},klib.urlHash=function(e,t){var a=(klib.getLocHash()||"#").substring(1);if(e){t=t||"/",a=a.beginsWith(t)?a.substring(a.indexOf(t)+t.length):a;var n=a.split(t);_.isNumber(e)?a=n&&n.length>e?n[e]:"":_.isArray(e)?a=0===e.length?n:_.object(e,n):_.isString(e)&&"?"==e&&(a=a.contains("\\?")?klib.getOnSplit(a,"?",1):"")}return a},klib.hashParam=function(e){var t=""+klib.urlHash("?");return"undefined"==typeof e||klib.isBlank(t)||(t=klib.urlParam(""+e,t)),t},klib.routeMatch=function(e,t){var a=new RegExp(":[a-zA-Z0-9\\_\\-]+","g"),n=new RegExp(e.replace(a,"([\\w\\+\\-\\|\\.\\?]+)")),i=e.match(a),l=t.match(n),r=l&&!_.isEmpty(l)?l.shift():"",o=i&&!_.isEmpty(i)?i.join(",").replace(/:/g,"").split(","):[],l=l&&!_.isEmpty(l)?l.join(",").replace(/\?/g,"").split(","):[],s=void 0;return r&&(s={hkeys:i,params:_.zipObject(o,l)}),s},klib.i18n={},klib.i18n.loaded=!1,klib.i18n.settings={name:"Language",path:"language/",encoding:"UTF-8",cache:!0,mode:"map",callback:null},klib.i18n.setLanguage=function(e,t){$.i18n&&(e=e||$.i18n.browserLang().replace(/-/g,"_"),t=$.extend(klib.i18n.settings,t),$.i18n.properties({name:t.name,language:e,path:t.path,encoding:t.encoding,cache:t.cache,mode:t.mode,callback:function(){$.i18n.loaded="undefined"==typeof $.i18n.loaded?!$.isEmptyObject($.i18n.map):$.i18n.loaded,klib.i18n.loaded=klib.i18n.loaded||$.i18n.loaded,e.length>1&&!$.i18n.loaded&&klib.i18n.setLanguage("_",t),klib.i18n.apply(),t.callback&&t.callback($.i18n.loaded)}}))},klib.i18n.text=function(e,t){var a=$.i18n.prop(e);if(t){var n="";_.each(_.keys(t),function(e){n=""+t[e],n&&n.beginsWith("i18n:","i")&&(n=$.i18n.prop(n.replace(/i18n:/gi,""))),a=a.replace(new RegExp("{"+e+"}","gi"),n)})}return a},klib.i18n.apply=klib.i18n.render=function(e,t){klib.i18n.loaded&&(e=e||"body",t=t||"",$(t+"[data-i18n]",e).each(function(e,t){var a=klib.toJSON($(t).data("i18n")||"{}"),n=a.i18ndata;n&&delete a.i18ndata,a&&!$.isEmptyObject(a)&&_.each(_.keys(a),function(e){var i=a[e],l=klib.i18n.text(i,n);_.each(e.split("_"),function(e){switch(e.toLowerCase()){case"html":$(t).html(l);break;case"text":$(t).text(l);break;default:$(t).attr(e,l)}})})}))},klib.extendBackbone=function(){window.Backbone&&_.extend(Backbone.Model.prototype,Backbone.Events,{activeCRUD:"",diffAttributes:function(e){return window.jsondiffpatch?jsondiffpatch.diff(this.previousAttributes(),this.toJSON(),e):this.changedAttributes()},sync:function(){return this.activeCRUD=arguments[0],Backbone.sync.apply(this,arguments)},url:function(){var e,t,a,n,i,l=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();if(l)for(n="object"==typeof l?l:{defaulturl:l},n.patch=n.patch||n.update,e=_.result(n,this.activeCRUD.toLowerCase()+"url")||_.result(n,"defaulturl")||urlError(),t=e.replace(/\{crud\}/gi,this.activeCRUD.toUpperCase()).replace(/\{now\}/gi,klib.now())+(this.isNew()||e.indexOf("?")>0?"":("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id));(a=t.match(/{([\s\S]*?)}/g))&&a&&a[0];)i=a[0].replace(/[{}]/g,""),t=t.replace(new RegExp(a[0],"g"),(i.indexOf(".")>=0?klib.find(this.toJSON(),i):this.get(i))||"");return t}})},klib.loadBackboneModelClass=function(e,t){t||(t={});var a={url:e,bbclass:Backbone.Model.extend({defaults:{}}),success:!1};return $.ajax({url:a.url,dataType:"text",async:!1,success:function(e){e=e.substring(e.indexOf("{")),a.bbclass=Backbone.Model.extend(klib.toJSON(e)),a.success=!0,t.success&&t.success(e)},error:function(e,n,i){t.fail&&t.fail(a.url,e,n,i)}}),a},klib.getModifiedElement=function(e){var t,a=void 0,n=$(e||"form:not([data-ignore-change]) :input:not(:disabled,:button,[data-ignore-change])");return _.every(n,function(e){return t||(e.tagName.match(/^(select|textarea)$/i)&&e.value!=e.defaultValue?t=!0:e.tagName.match(/^input$/i)&&(e.type.match(/^(checkbox|radio)$/i)&&e.checked!=e.defaultChecked?t=!0:e.type.match(/^(text|password|hidden|color|email|month|number|tel|time|url|range|date|datetime|datetime-local)$/i)&&e.value!=e.defaultValue&&(t=!0)),t&&(a=e)),!t}),a},klib.getModifiedElements=function(e){var t,a=[],n=$(e||"form:not([data-ignore-change]) :input:not(:disabled,:button,[data-ignore-change])");return n.each(function(e,n){t=!1,n.tagName.match(/^(select|textarea)$/i)&&n.value!=n.defaultValue?t=!0:n.tagName.match(/^input$/i)&&(n.type.match(/^(checkbox|radio)$/i)&&n.checked!=n.defaultChecked?t=!0:n.type.match(/^(text|password|hidden|color|email|month|number|tel|time|url|range|date|datetime|datetime-local)$/i)&&n.value!=n.defaultValue&&(t=!0)),t&&a.push(n)}),a},klib.initTrackElValueChanges=klib.resetElementsDefaultValue=function(e){$(e||"form :input:not(:disabled)").each(function(e,t){t.defaultValue=t.value,t.tagName.match(/^input$/i)&&t.type.match(/^(checkbox|radio)$/i)&&t.checked!=t.defaultChecked&&(t.defaultChecked=t.checked)})},klib.trash={container:[],push:function(e){this.container.push(e)},empty:function(){this.container=[]},pick:function(e){return e?this.container[e]:this.container}},klib.fillData=function(e,t,a){var n="object"==typeof e;t&&"object"==typeof t&&(a=t,t=null),t=t||"body";var i={dataParams:{},dataCache:!1,keyFormat:"aBc",selectPattern:"[name='?']",formatterCommon:null,formatterOnKeys:null,resetElDefault:!0,resetElDefaultInContext:!0,keysMap:{}};if($.extend(i,a),n||$.ajax({url:e,data:i.dataParams,cache:i.dataCache,dataType:"text",async:!1,success:function(t){e=klib.toJSON(t),n="object"==typeof e},error:function(e,t,a){}}),n){var l=i.keyFormat;l=null!=l.match(/^[a-z]/)?"aBc":l,l=null!=l.match(/^[A-Z]/)?"AbC":l;var r=klib.keysDotted(e);_.each(r,function(a){var n=""+(a.replace(/[\[\]]/g,"_")||""),r=a.replace(/\[[0-9]+\]/g,""),o=/\[[0-9]+\]/.test(a);switch(l){case"_":n=klib.dotToX(n,"_"),r=klib.dotToX(r,"_");break;case"AbC":n=klib.dotToTitleCase(n),r=klib.dotToTitleCase(r);break;default:n=klib.dotToCamelCase(n),r=klib.dotToCamelCase(r)}var s={patternKey:n+(o?" || "+r:""),formatterKey:r,isArrayChild:o};klib.trash.push(s),klib.trash.empty();var d=i.selectPattern.replace(/\?/g,n);(i.keysMap[n]||i.keysMap[r])&&(i.keysMap[n]=i.keysMap[n]||{},i.keysMap[r]=i.keysMap[r]||{},i.keysMap[n].pattern=i.keysMap[n].pattern||i.keysMap[r].pattern,i.keysMap[n].pattern&&(d=i.keysMap[n].pattern.replace(/\?/g,n)),i.keysMap[r].formatter&&(i.formatterOnKeys=i.formatterOnKeys||{},i.formatterOnKeys[r]=i.keysMap[r].formatter));var c=null;$(d,t).length>0&&(c=klib.find(e,a),!i.formatterOnKeys&&i.formatterCommon&&(c=i.formatterCommon(c,a,e)),i.formatterOnKeys&&(i.formatterOnKeys[r]?c=i.formatterOnKeys[r](c,a,e):i.formatterCommon&&(c=i.formatterCommon(c,a,e)))),$(d,t).each(function(e,t){switch(t.tagName.toUpperCase()){case"INPUT":switch(t.type.toLowerCase()){case"text":case"password":case"hidden":case"color":case"date":case"datetime":case"datetime-local":case"email":case"month":case"number":case"search":case"tel":case"time":case"url":case"range":case"button":case"submit":case"reset":$(t).val(c),!i.resetElDefaultInContext&&i.resetElDefault&&(t.defaultValue=t.value);break;case"checkbox":case"radio":t.checked=t.value.equalsIgnoreCase(c),!i.resetElDefaultInContext&&i.resetElDefault&&(t.defaultChecked=t.checked)}break;case"SELECT":klib.selectOptionForValue(t,c),!i.resetElDefaultInContext&&i.resetElDefault&&(t.defaultValue=t.value);break;case"TEXTAREA":$(t).val(c),!i.resetElDefaultInContext&&i.resetElDefault&&(t.defaultValue=t.value);break;default:$(t).html(c)}})}),i.resetElDefaultInContext&&klib.resetElementsDefaultValue(t+" :input")}},klib.toRenderDataStructure=function(e,t){var a={},n={},i={},l={};switch(t&&(l=_.isString(t)?klib.queryStringToJson(t):_.isObject(t)?t:{}),!0){case _.isString(e):e.contains("\\|")&&(a.dataModel=klib.getOnSplit(e,"|",0),e=klib.getOnLastSplit(1)),a.dataUrl=e,_.isEmpty(l)||(a.dataParams=l);break;case _.isArray(e):n={urls:[]},i={},_.each(e,function(e,t){i={url:e,params:l},e.contains("\\|")&&(i.target=klib.getOnSplit(e,"|",0),i.url=klib.getOnLastSplit(1)),n.urls.push(i)});break;case _.isObject(e):n={urls:[]},i={},_.each(_.keys(e),function(t,a){i={name:t,url:e[t],params:l},e[t].contains("\\|")&&(i.target=klib.getOnSplit(e[t],"|",0),i.url=klib.getOnLastSplit(1)),n.urls.push(i)})}return _.isEmpty(n.urls)||(a.dataCollection=n),a},klib.viewModels={},klib.renderHistory={},klib.renderHistoryMax=0,klib.defaults={dataTemplateEngine:"handlebars"},klib.render=function(viewContainderId,uOptions){var retValue={id:"",view:{},model:{},cron:"",elDataAttr:{},iOptions:uOptions},kAjaxRequestsQue=[],foundViewContainer=klib.isElementExist(viewContainderId);foundViewContainer&&(retValue.elDataAttr=$(viewContainderId).data());var kDefaultTemplateConfig={backbone:{engine:"underscore",template:"x-underscore-template"},hogan:{engine:"hogan",template:"x-hogan-template"},unknown:{engine:"unknown",template:"x-unknown-template"}},noOfArgs=arguments.length,useOptions=noOfArgs>1,useParamData=useOptions&&uOptions.hasOwnProperty("data"),dataFound=!0,kRVOptions={data:{},dataUrl:"",dataUrlErrorHandle:"",dataParams:{},dataModel:"",dataModelType:"",dataCache:!1,dataCollection:{},dataTemplatesCollectionUrl:"",dataTemplates:{},dataTemplateEngine:"",dataTemplate:"",dataTemplatesCache:!0,dataScripts:{},dataScriptsCache:!0,dataStyles:{},dataStylesCache:!0,dataRenderEngine:"",dataRenderCallback:"",dataRenderId:""};if(foundViewContainer||(klib.isElementExist("#kRunTimeHtmlContainer")||$("body").append("<div id='kRunTimeLoadContainer' style='display:none;'></div>"),$("#kRunTimeLoadContainer").append("<div id='"+viewContainderId.replace(/\#/gi,"")+"'></div>")),useOptions){var saveOptions=uOptions.hasOwnProperty("saveOptions")&&uOptions.saveOptions;for(var key in uOptions)kRVOptions[key]=uOptions[key],saveOptions&&"data"!==key&&"saveOptions"!==key&&$(viewContainderId).data(""+(""+(_.at(""+key,4)||"")).toLowerCase()+key.slice(5),klib.toStr(uOptions[key]))}var kRenderId=(""+$(viewContainderId).data("renderId")).replace(/undefined/,"");
klib.isBlank(kRVOptions.dataRenderId)||(kRenderId=kRVOptions.dataRenderId),retValue.id=kRenderId.ifBlank("kRender"+klib.now()+klib.rand(1e3,9999));var kRenderEngine=(""+$(viewContainderId).data("renderEngine")).replace(/undefined/,"");klib.isBlank(kRVOptions.dataRenderEngine)||(kRenderEngine=kRVOptions.dataRenderEngine),kRenderEngine=kRenderEngine.ifBlank("unknown").toLowerCase();var kRenderEngineKey=kRenderEngine;kDefaultTemplateConfig.hasOwnProperty(kRenderEngineKey)||(kRenderEngineKey="unknown",kRenderEngine+="-unknown");var kTemplateType=kDefaultTemplateConfig[kRenderEngineKey].template,kTemplateEngine=(""+$(viewContainderId).data("templateEngine")).replace(/undefined/,"");switch(klib.isBlank(kRVOptions.dataTemplateEngine)||(kTemplateEngine=kRVOptions.dataTemplateEngine),klib.isBlank(kTemplateEngine)&&(kTemplateEngine=kRenderEngineKey.equalsIgnoreCase("unknown")?klib.defaults.dataTemplateEngine||"handlebars":kTemplateEngine.ifBlank(kDefaultTemplateConfig[kRenderEngineKey].engine).toLowerCase()),kTemplateEngine){case"hogan":"unknown"==kRenderEngine&&(kRenderEngineKey=kRenderEngine=kTemplateEngine,kTemplateType=kDefaultTemplateConfig[kRenderEngineKey].template)}var kBackboneModelOption={},kViewDataModelType=(""+$(viewContainderId).data("modelType")).replace(/undefined/,"");if(klib.isBlank(kRVOptions.dataModelType)||(kViewDataModelType=kRVOptions.dataModelType),kViewDataModelType.beginsWith("backbone:","i")&&(kBackboneModelOption=klib.toJSON(kViewDataModelType.substring(9)),kViewDataModelType="backbone",kRenderEngine.equalsIgnoreCase("unknown")&&(kRenderEngine="backbone")),kViewDataModelType=kViewDataModelType.ifBlank().toLowerCase(),!useOptions||!uOptions.hasOwnProperty("dataScriptsCache")){var scriptsCacheInTagData=(""+$(viewContainderId).data("scriptsCache")).replace(/undefined/,"");klib.isBlank(scriptsCacheInTagData)||(kRVOptions.dataScriptsCache=scriptsCacheInTagData.toBoolean())}var vScriptsList=(""+$(viewContainderId).data("scripts")).replace(/undefined/,"");vScriptsList&&klib.isBlank((vScriptsList||"").replace(/[^:'\"]/g,""))&&(vScriptsList="'"+vScriptsList.split(",").join("','")+"'");var vScripts=klib.toJSON(vScriptsList||"{}");if($.isEmptyObject(kRVOptions.dataScripts)||(vScripts=kRVOptions.dataScripts),_.isArray(vScripts)&&_.remove(vScripts,function(e){return!e}),vScripts&&!$.isEmptyObject(vScripts)){if(_.isArray(vScripts)){var newScriptsObj={},dynScriptIDForContainer="__scripts_"+viewContainderId.trim("#")+"_";_.each(vScripts,function(e,t){e&&(newScriptsObj[dynScriptIDForContainer+t]=""+e)}),vScripts=_.isEmpty(newScriptsObj)?{}:newScriptsObj}var vScriptsNames=_.keys(vScripts);_.each(vScriptsNames,function(e){kAjaxRequestsQue=klib.loadScript(e,vScripts[e],kRVOptions.dataScriptsCache,kAjaxRequestsQue)})}$.when.apply($,kAjaxRequestsQue).then(function(){}).fail(function(){});var dataModelName=(""+$(viewContainderId).data("model")).replace(/undefined/,""),viewDataModelName;klib.isBlank(kRVOptions.dataModel)||(dataModelName=kRVOptions.dataModel);var dataModelUrl=(""+$(viewContainderId).data("url")).replace(/undefined/,"");klib.isBlank(kRVOptions.dataUrl)||(dataModelUrl=kRVOptions.dataUrl);var isLocalDataModel=useParamData||dataModelUrl.beginsWith("local:","i"),defaultDataModelName=dataModelUrl.beginsWith("local:","i")?dataModelUrl.replace(/local:/gi,""):"data";dataModelName=dataModelName.ifBlank(defaultDataModelName),viewDataModelName=dataModelName.replace(/\./g,"_");var kTemplateModelData={};if(useParamData)kTemplateModelData[viewDataModelName]=kRVOptions.data;else{if(!useOptions||!uOptions.hasOwnProperty("dataCache")){var dataCacheInTagData=(""+$(viewContainderId).data("cache")).replace(/undefined/,"");klib.isBlank(dataCacheInTagData)||(kRVOptions.dataCache=dataCacheInTagData.toBoolean())}if(klib.isBlank(dataModelUrl)){kTemplateModelData[viewDataModelName]={};var dataModelCollection=(""+$(viewContainderId).data("collection")).replace(/undefined/,"");dataModelCollection&&(dataModelCollection=klib.toJSON(dataModelCollection)),klib.isBlank(kRVOptions.dataCollection)||(dataModelCollection=kRVOptions.dataCollection),_.isArray(dataModelCollection)&&(dataModelCollection={urls:dataModelCollection});var dataModelUrls=dataModelCollection.urls;if(klib.isBlank(dataModelUrls));else if(_.isArray(dataModelUrls)){var dataIndexApi=0,defaultAutoDataNamePrefix=dataModelCollection.nameprefix||"data";_.each(dataModelUrls,function(dataApi){var defaultApiDataModelName=defaultAutoDataNamePrefix+dataIndexApi,apiDataModelName=_.has(dataApi,"name")?(""+dataApi.name).replace(/[^a-zA-Z0-9]/gi,""):_.has(dataApi,"target")?""+dataApi.target:defaultApiDataModelName,apiDataUrl=_.has(dataApi,"url")?dataApi.url:_.has(dataApi,"path")?dataApi.path:"";apiDataModelName.contains(".")&&(apiDataModelName=_.last(apiDataModelName.split("."),1)),apiDataModelName=apiDataModelName.ifBlank(defaultApiDataModelName),apiDataUrl&&kAjaxRequestsQue.push($.ajax({url:apiDataUrl,data:_.has(dataApi,"params")?dataApi.params:_.has(dataApi,"data")?dataApi.data:{},cache:_.has(dataApi,"cache")?dataApi.cache:kRVOptions.dataCache,dataType:"text",success:function(result){var targetApiData,targetDataModelName=_.has(dataApi,"target")?""+dataApi.target:"",oResult=(""+result).toJSON();targetApiData=targetDataModelName.indexOf(".")>0?klib.hasKey(oResult,targetDataModelName)?klib.find(oResult,targetDataModelName):oResult:oResult.hasOwnProperty(targetDataModelName)?oResult[targetDataModelName]:oResult,kTemplateModelData[viewDataModelName][apiDataModelName]?(kTemplateModelData[viewDataModelName][apiDataModelName]=[kTemplateModelData[viewDataModelName][apiDataModelName]],kTemplateModelData[viewDataModelName][apiDataModelName].push(targetApiData)):kTemplateModelData[viewDataModelName][apiDataModelName]=targetApiData;var fnApiDataSuccess=dataApi.success||dataApi.onsuccess||dataApi.onSuccess;fnApiDataSuccess||(fnApiDataSuccess=dataModelCollection.success||dataModelCollection.onsuccess||dataModelCollection.onSuccess),fnApiDataSuccess&&(_.isFunction(fnApiDataSuccess)?fnApiDataSuccess(oResult,dataApi):_.isString(fnApiDataSuccess)&&eval("("+fnApiDataSuccess+"(oResult, dataApi))"))},error:function(jqXHR,textStatus,errorThrown){var fnOnApiDataUrlErrorHandle=dataApi.error||dataApi.onerror||dataApi.onError;fnOnApiDataUrlErrorHandle||(fnOnApiDataUrlErrorHandle=dataModelCollection.error||dataModelCollection.onerror||dataModelCollection.onError,fnOnApiDataUrlErrorHandle||klib.isBlank(kRVOptions.dataUrlErrorHandle)||(fnOnApiDataUrlErrorHandle=kRVOptions.dataUrlErrorHandle)),fnOnApiDataUrlErrorHandle&&(_.isFunction(fnOnApiDataUrlErrorHandle)?fnOnApiDataUrlErrorHandle(jqXHR,textStatus,errorThrown):_.isString(fnOnApiDataUrlErrorHandle)&&eval("("+fnOnApiDataUrlErrorHandle+"(jqXHR, textStatus, errorThrown))"))}})),dataIndexApi++})}else;}else if(dataModelUrl.beginsWith("local:","i")){var localDataModelName=dataModelUrl.replace(/local:/gi,""),localDataModelObj={};if("undefined"!=typeof eval("("+localDataModelName+")")&&eval("(localDataModelObj="+localDataModelName+")"),klib.isBlank(kViewDataModelType))!isLocalDataModel&&dataModelName.indexOf(".")>0?kTemplateModelData[viewDataModelName]=klib.hasKey(localDataModelObj,dataModelName)?klib.find(localDataModelObj,dataModelName):localDataModelObj:kTemplateModelData[viewDataModelName]=localDataModelObj.hasOwnProperty(dataModelName)?localDataModelObj[dataModelName]:localDataModelObj;else if($.isEmptyObject(localDataModelObj)&&!$.isEmptyObject(kBackboneModelOption)){var bbClassUrl=kBackboneModelOption.classpath||"";if(!klib.isBlank(bbClassUrl)){if(bbClassUrl.beginsWith("local:","i")){var bbClassLocal=bbClassUrl.substring(6);eval("( localDataModelObj = new "+bbClassLocal+"() )")}else{var noop=function(){},loadBackboneModelClassResult=klib.loadBackboneModelClass(bbClassUrl,{success:kBackboneModelOption.classsuccess||noop,fail:kBackboneModelOption.classerror||noop});localDataModelObj=new loadBackboneModelClassResult.bbclass,loadBackboneModelClassResult.success&&(kBackboneModelOption.defaults&&localDataModelObj.set(kBackboneModelOption.defaults),localDataModelObj.fetch({async:!1,cache:!1,success:kBackboneModelOption.fetchsuccess||noop,error:kBackboneModelOption.fetcherror||noop}))}eval("("+localDataModelName+"=localDataModelObj)"),kTemplateModelData[viewDataModelName]=localDataModelObj.toJSON()}}else kTemplateModelData[viewDataModelName]=kViewDataModelType.equalsIgnoreCase("backbone")?localDataModelObj.toJSON():localDataModelObj}else kAjaxRequestsQue.push($.ajax({url:dataModelUrl,data:kRVOptions.dataParams,cache:kRVOptions.dataCache,dataType:"text",success:function(e){var t=(""+e).toJSON();dataModelName.indexOf(".")>0?kTemplateModelData[viewDataModelName]=klib.hasKey(t,dataModelName)?klib.find(t,dataModelName):t:kTemplateModelData[viewDataModelName]=t.hasOwnProperty(dataModelName)?t[dataModelName]:t},error:function(jqXHR,textStatus,errorThrown){var fnOnDataUrlErrorHandle=(""+$(viewContainderId).data("urlErrorHandle")).replace(/undefined/,"");klib.isBlank(kRVOptions.dataUrlErrorHandle)||(fnOnDataUrlErrorHandle=""+kRVOptions.dataUrlErrorHandle),klib.isBlank(fnOnDataUrlErrorHandle)||eval("("+fnOnDataUrlErrorHandle+"(jqXHR, textStatus, errorThrown))")}}))}if(dataFound){var vTemplate2RenderInTag=(""+$(viewContainderId).data("template")).replace(/undefined/,""),vTemplatesList=(""+$(viewContainderId).data("templates")).replace(/undefined/,"");vTemplatesList&&klib.isBlank((vTemplatesList||"").replace(/[^:'\"]/g,""))&&(vTemplatesList="'"+vTemplatesList.split(",").join("','")+"'");var vTemplates=klib.toJSON(vTemplatesList||"{}");if(!_.isObject(kRVOptions.dataTemplates)&&_.isString(kRVOptions.dataTemplates)&&(vTemplatesList=(kRVOptions.dataTemplates||"").trim(),klib.isBlank((vTemplatesList||"").replace(/[^:'\"]/g,""))&&(vTemplatesList="'"+vTemplatesList.split(",").join("','")+"'"),kRVOptions.dataTemplates=klib.toJSON(vTemplatesList)),$.isEmptyObject(kRVOptions.dataTemplates)||(vTemplates=kRVOptions.dataTemplates,vTemplatesList=""+JSON.stringify(vTemplates)),(_.isEmpty(klib.toJSON((vTemplatesList||"").trim()))||_.isArray(vTemplates)&&1==vTemplates.length&&klib.isBlank(vTemplates[0]))&&(vTemplates={},vTemplatesList=""),_.isArray(vTemplates)&&!_.isEmpty(vTemplates)){var newTemplatesObj={},dynTmplIDForContainer="__tmpl_"+viewContainderId.trim("#")+"_";_.each(vTemplates,function(e,t){e&&(newTemplatesObj[dynTmplIDForContainer+t]=""+e)}),console.log(newTemplatesObj),_.isEmpty(newTemplatesObj)?(vTemplates={},vTemplatesList=""):(vTemplates=newTemplatesObj,vTemplatesList=""+JSON.stringify(vTemplates))}if(!vTemplates||$.isEmptyObject(vTemplates)){vTemplates={};var _dataTemplate=kRVOptions.dataTemplate,_tmplKey="",_tmplLoc="";klib.isBlank(_dataTemplate)&&(klib.isBlank(vTemplate2RenderInTag)||(_dataTemplate=vTemplate2RenderInTag)),_dataTemplate=(_dataTemplate||"").trim(),klib.isBlank(_dataTemplate)||_dataTemplate.equalsIgnoreCase("inline")||_dataTemplate.equals(".")?_tmplKey="_tmplInline_"+viewContainderId.trim("#"):_dataTemplate.beginsWith("#")?_tmplKey=_dataTemplate.trim("#"):_dataTemplate.contains(":")&&!_dataTemplate.beginsWithIgnoreCase("http")?(_tmplKey=klib.getOnSplit(_dataTemplate,":",0).replace(/[^a-z0-9]/gi,""),_tmplLoc=klib.getOnLastSplit(1)):(_tmplKey="__tmpl_"+viewContainderId.trim("#")+"_"+klib.now()+klib.rand(1e3,9999),_tmplLoc=_dataTemplate),vTemplates[_tmplKey]=_tmplLoc.replace(/['\"]/g,"")}var dataTemplatesCollectionUrl=(""+$(viewContainderId).data("templatesCollectionUrl")).replace(/undefined/,"");if(klib.isBlank(kRVOptions.dataTemplatesCollectionUrl)||(dataTemplatesCollectionUrl=kRVOptions.dataTemplatesCollectionUrl),!klib.isBlank(dataTemplatesCollectionUrl)){var templateCollectionId=viewContainderId+"_TemplatesCollection";klib.loadTemplatesCollection(templateCollectionId,dataTemplatesCollectionUrl)}if(vTemplates&&!$.isEmptyObject(vTemplates)){var vTemplateNames=_.keys(vTemplates);if(!useOptions||!uOptions.hasOwnProperty("dataTemplatesCache")){var templatesCacheInTagData=(""+$(viewContainderId).data("templatesCache")).replace(/undefined/,"");klib.isBlank(templatesCacheInTagData)||(kRVOptions.dataTemplatesCache=templatesCacheInTagData.toBoolean())}_.each(vTemplateNames,function(e,t){kAjaxRequestsQue=klib.loadTemplate(e,vTemplates[e],kTemplateType,viewContainderId,kAjaxRequestsQue,!kRVOptions.dataTemplatesCache)});var vTemplate2RenderID="#"+vTemplateNames[0].trim("#");if(!useOptions||!uOptions.hasOwnProperty("dataStylesCache")){var stylesCacheInTagData=(""+$(viewContainderId).data("stylesCache")).replace(/undefined/,"");klib.isBlank(stylesCacheInTagData)||(kRVOptions.dataStylesCache=stylesCacheInTagData.toBoolean())}var vStylesList=(""+$(viewContainderId).data("styles")).replace(/undefined/,"");vStylesList&&klib.isBlank((vStylesList||"").replace(/[^:'\"]/g,""))&&(vStylesList="'"+vStylesList.split(",").join("','")+"'");var vStyles=klib.toJSON(vStylesList||"{}");if($.isEmptyObject(kRVOptions.dataStyles)||(vStyles=kRVOptions.dataStyles),_.isArray(vStyles)&&_.remove(vStyles,function(e){return!e}),vStyles&&!$.isEmptyObject(vStyles)){if(_.isArray(vStyles)){var newStylesObj={},dynStyleIDForContainer="__styles_"+viewContainderId.trim("#")+"_";_.each(vStyles,function(e,t){e&&(newStylesObj[dynStyleIDForContainer+t]=""+e)}),vStyles=_.isEmpty(newStylesObj)?{}:newStylesObj}var vStylesNames=_.keys(vStyles);_.each(vStylesNames,function(e){kAjaxRequestsQue=klib.loadStyle(e,vStyles[e],kRVOptions.dataStylesCache,kAjaxRequestsQue)})}$.when.apply($,kAjaxRequestsQue).then(function(){$(viewContainderId).html("");try{retValue.model=kTemplateModelData[viewDataModelName];var e,t=kTemplateModelData[viewDataModelName];switch(kRenderEngine){case"backbone":(!isLocalDataModel||klib.isBlank(kViewDataModelType))&&(retValue.model=new Backbone.Model(retValue.model),t=retValue.model.toJSON());break;default:if(isLocalDataModel&&!klib.isBlank(kViewDataModelType))switch(kViewDataModelType){case"backbone":t=retValue.model.toJSON()}}klib.viewModels[retValue.id]=retValue.model;var a=$(vTemplate2RenderID).html()||"";switch(kTemplateEngine){case"handlebar":case"handlebars":e=Handlebars.compile(a)(t);break;case"underscore":e=_.template(a)(t);break;case"underscore-as-mustache":var n={interpolate:/\{\{(.+?)\}\}/g,escape:/\{\{\{(.+?)\}\}\}/g};e=_.template(a,t,n);break;case"mustache":e=Mustache.compile(a)(t);break;case"hogan":e=Hogan.compile(a).render(t);break;default:e=a}switch(kRenderEngine){case"backbone":retValue.view=new(Backbone.View.extend({el:viewContainderId,render:function(){return this.$el.html(e),this}})),retValue.view.render();break;default:retValue.view=e,$(viewContainderId).html(retValue.view)}var i=_.keys(klib.renderHistory),l=i.length;l>klib.renderHistoryMax&&$.each(i.splice(0,l-klib.renderHistoryMax),function(e,t){delete klib.renderHistory[t]}),retValue.cron=""+klib.now(),klib.renderHistoryMax>0&&(klib.renderHistory[retValue.id]=retValue),klib.reflowFoundation(viewContainderId),klib.initKeyTracking(),klib.i18n.apply(viewContainderId),klib.initRoutes(viewContainderId);var r=(""+$(viewContainderId).data("renderCallback")).replace(/undefined/,"");if(kRVOptions.dataRenderCallback&&(r=kRVOptions.dataRenderCallback),isKHashRouteOn&&klib.routes&&klib.routes.hasOwnProperty("_renderCallback")&&_.isFunction(klib.routes._renderCallback)&&klib.routes._renderCallback.call(void 0,retValue),r){var o=r;_.isString(o)&&(o=klib.findSafe(window,o)),o?_.isFunction(o)&&o.call(void 0,retValue):(""+r).beginsWith("klib")&&(""+r).endsWith("_renderCallback")}$("[rel='kRender'],[data-render],[data-krender]",viewContainderId).kRender()}catch(s){}}).fail(function(){}).done(klib.runOnceOnRender)}}return retValue},klib.hasAutoRoutes=function(e,t){var a="[data-kroute-default]"+(e?"[href"+(t?t:"")+"='"+e+"']":"");return $(a).length>0},klib.routeCurLocHashAttemptDelaySec=3,klib.routeCurLocHashAttempt=0,klib.routeCurLocHash=function(){var e=(klib.getLocHash()||"").ifBlank(klib.routesOptions.defaultPageRoute);isKHashRouteOn&&e&&!klib.hasAutoRoutes(e)&&(klib.route(e)||klib.routeCurLocHashAttempt<5&&(klib.routeCurLocHashAttempt++,setTimeout(klib.routeCurLocHash,1e3*klib.routeCurLocHashAttemptDelaySec)))},klib.finallyOnRender=[],klib.runOnceOnRenderFunctions=[klib.routeCurLocHash],klib.runOnceOnRender=function(){(klib.runOnceOnRenderFunctions&&!_.isEmpty(klib.runOnceOnRenderFunctions)||klib.finallyOnRender&&!_.isEmpty(klib.finallyOnRender))&&(klib.runOnceOnRenderFunctions||(klib.runOnceOnRenderFunctions=[]),_.isArray(klib.runOnceOnRenderFunctions)||(klib.runOnceOnRenderFunctions=[klib.runOnceOnRenderFunctions]),_.isArray(klib.runOnceOnRenderFunctions)&&(klib.finallyOnRender&&(_.isArray(klib.finallyOnRender)||(klib.finallyOnRender=[klib.finallyOnRender]),klib.runOnceOnRenderFunctions=klib.runOnceOnRenderFunctions.concat(klib.finallyOnRender)),_.each(klib.runOnceOnRenderFunctions,function(e,t){_.isFunction(e)&&e()})),klib.finallyOnRender=klib.runOnceOnRenderFunctions=void 0)},klib.setElIdIfNot=function(e){var t=$(e);return klib.isBlank(t.attr("id"))&&t.attr("id","_el_"+klib.now()+"_"+klib.rand(1e3,9999)),t.attr("id")},klib.reflowFoundation=function(e){"Foundation"in window&&$(e||document).foundation("reflow")},$.expr[":"].regex=function(e,t,a){var n=a[3].split(","),i=/^(data|css):/,l={method:n[0].match(i)?n[0].split(":")[0]:"attr",property:n.shift().replace(i,"")},r="ig",o=new RegExp(n.join("").replace(/^\s+|\s+$/g,""),r);return o.test($(e)[l.method](l.property))},$.fn.extend({kRender:function(e){this.each(function(){__renderView(this,e)})}}),$.extend({kRender:function(e,t){$(e).kRender(t)}}),klib.initDataValidation=function(){},klib.doDataValidation=function(){},klib.properties={version:klib.VERSION},klib.routes={},klib.routesOptions={useHashRoute:!0,usePatterns:!0,defaultPageRoute:"",beforeRoute:"",defaultTemplateExt:".html",loadDefaultScript:!0,defaultRouteTargetContainerIdPrefix:"routeContainer_",defaultRouteTemplateContainerIdPrefix:"template_"},klib.routePatterns={routes:[],register:void 0,deregister:void 0},klib.routePatterns.register=function(e,t){if(e&&!_.isEmpty(e)){var a=function(e,t){_.has(e,"pattern")&&(e.pattern=e.pattern.replace(/\?/g,"\\?"),_.has(e,"name")||(e.name=e.pattern.replace(/[^a-z0-9_]/gi,"")),_.has(e,"routeoptions")||(e.routeoptions={}),_.find(klib.routePatterns.routes,{pattern:e.pattern})||(_.find(klib.routePatterns.routes,{name:e.name})?t&&klib.routePatterns.routes.push(e):klib.routePatterns.routes.push(e)))};_.isArray(e)?_.each(e,function(e){a(e,t)}):_.isObject(e)&&a(e,t)}},klib.routePatterns.deregister=function(e){if(e&&!_.isEmpty(e)){var t=function(e){if(e){var t=_.findIndex(klib.routePatterns.routes,function(t){return t.name==e||t.pattern==e});t>=0&&_.pullAt(klib.routePatterns.routes,t)}};_.isArray(e)?_.each(e,function(e){t(e)}):_.isString(e)&&t(e)}},klib.routeName=function(e){var t=e||klib.urlHash();return t.contains("\\?")&&(t=t.split("?")[0]),t.trimLeft("#").replace(/[^a-z0-9]/gi,"_")},klib.routeContainerId=function(e){var t=klib.routesOptions.defaultRouteTargetContainerIdPrefix.trimLeft("#");return t+klib.routeName(e)},klib.routeTemplateId=function(e){var t=klib.routesOptions.defaultRouteTemplateContainerIdPrefix.trimLeft("#");return t+klib.routeName(e)},klib.routeRender=function(e,t){var a=e?$(e):void 0,n=a?""+a.data("kroute")||"":"";(n.trim().equalsIgnoreCase("false")||n.trim().equalsIgnoreCase("no")||n.trim().equalsIgnoreCase("off"))&&(n="quit:true");var i=n?klib.toJSON(n):{};if(_.merge(i,t),!i.hasOwnProperty("quit")||!i.quit){var l="#RouteNotDefinedInHREF";a?l=a.attr("href"):t.urlhash&&(l=t.urlhash.url),l=l.trimLeft("#");var r="";if(l.contains("\\?")){var o=l.split("?");l=o[0],r=o[1]}var s=i.name||klib.routeName(l);if(klib.routes[s])klib.routes[s](a,r,i);else{var d=i.hasOwnProperty("ext")||i.hasOwnProperty("tmplext")||i.hasOwnProperty("tmplExt"),c=""+(i.target||"").trim(),u=d?i.ext||i.tmplext||i.tmplExt:klib.routesOptions.defaultTemplateExt||"",p=i.tmplengine||i.tmplEngine||"",k=(l+u+"?"+r).trimRight("\\?"),b=l+".js",f="klib.routes."+s+"_before",m="klib.routes."+s+"_renderCallback",h=klib.findIgnoreCase(i,"usetargetoptions"),g={dataRenderCallback:m,rElRouteOptions:i,rElDataAttr:a?a.data():{}};i.hasOwnProperty("template")&&!i.hasOwnProperty("templates")&&(i.templates=i.template,delete i.template),c.equalsIgnoreCase(".")?c="#"+klib.setElIdIfNot(a):klib.isBlank(c)&&(c="#"+klib.routeContainerId(s));var v=klib.isElementExist(c);i.hasOwnProperty("dataCache")&&(g.dataCache=i.dataCache),i.hasOwnProperty("templatesCache")&&(g.dataTemplatesCache=i.templatesCache),i.hasOwnProperty("scriptsCache")&&(g.dataScriptsCache=i.scriptsCache),g.dataTemplates={};var y="__kRouteTemplate_"+s;if(!i.hasOwnProperty("templates")||i.templates){var O=i.templates,C=klib.routeTemplateId(s),S="#"+C,T="__tmpl_"+C;switch(!0){case _.isString(O):var w=y,R=O.trim();R.equalsIgnoreCase(".")?R=k:R.equalsIgnoreCase("#")&&(w=T,R=S),g.dataTemplates[w]=R.ifBlank("none");break;case _.isArray(O):_.indexOf(O,".")>=0&&(g.dataTemplates[y+"_dot"]=k,_.pull(O,".")),_.indexOf(O,"#")>=0&&(g.dataTemplates[T]=S,_.pull(O,"#")),_.each(O,function(e,t){g.dataTemplates[y+"_"+(t+1)]=e.ifBlank("none")});break;default:g.dataTemplates[y]=k}}else g.dataTemplates[y]="none";p&&(g.dataTemplateEngine=p);var D=!i.hasOwnProperty("scripts")||i.scripts;if(D){g.dataScripts={};var x="__kRouteScript_"+s;switch(!0){case _.isString(i.scripts):g.dataScripts[x]=_.indexOf(i.scripts,".")>=0?b:i.scripts;break;case _.isArray(i.scripts):_.indexOf(i.scripts,".")>=0&&(g.dataScripts[x]=b,_.pull(i.scripts,".")),_.each(i.scripts,function(e,t){g.dataScripts[x+"_"+(t+1)]=e});break;default:klib.routesOptions.loadDefaultScript&&(g.dataScripts[x]=b)}}if(i.dataUrl||i.dataurl){var E=i.dataurl||i.dataUrl,M=klib.toRenderDataStructure(E,r);_.isEmpty(M)||_.merge(g,M)}var I=i.hasOwnProperty("after")||i.hasOwnProperty("callback")||i.hasOwnProperty("callBack");if((I||i.after||i.callback||i.callBack)&&(g.dataRenderCallback=i.after||i.callback||i.callBack||""),i.hasOwnProperty("scripts")&&klib.isBlank(i.hasOwnProperty("scripts"))&&(I?_.isString(g.dataRenderCallback)&&g.dataRenderCallback.equalsIgnoreCase(".")&&(g.dataRenderCallback=m):g.dataRenderCallback=""),h&&v){var j=$(c);j.data("url")&&delete g.dataUrl,(j.data("template")||j.data("templates"))&&delete g.dataTemplates,j.data("scripts")&&delete g.dataScripts,j.data("templateEngine")&&delete g.dataTemplateEngine,j.data("renderCallback")&&delete g.dataRenderCallback}var A={},N=i.before||i.beforeroute||i.beforeRoute||klib.routesOptions.beforeRoute;N&&(!_.isFunction(N)&&_.isString(N)&&(N.equals(f)&&(f=void 0),N=klib.findSafe(window,N)),_.isFunction(N)&&(A=N.call(void 0,{el:a,target:c,renderOptions:g,routeOptions:i}),_.isObject(A)&&_.merge(g,A))),f&&(N=klib.findSafe(window,f),N&&_.isFunction(N)&&(A=N.call(void 0,{el:a,target:c,renderOptions:g,routeOptions:i}),_.isObject(A)&&_.merge(g,A))),g.hasOwnProperty("render")&&!g.render||i.hasOwnProperty("render")&&!i.render||klib.render(c,g)}return!0}},klib.route=function(e,t){if(_.isString(e)&&klib.isBlank((""+e).trim("#")))return!1;var a=!_.isString(e);if(t=t||{},!a){var n=$("[data-kroute][href='"+e+"']");if(a=!_.isEmpty(n))e=n.get(0);else if(klib.routesOptions.usePatterns){var i,l=_.findIndex(klib.routePatterns.routes,function(t){var a=!1,n=klib.routeMatch(t.pattern,e);return n&&(a=!0,i=_.merge({},t.routeoptions||{}),i.urlhash={pattern:t.pattern.replace(/\\\?/g,"?"),url:e,urlParams:n}),a});0>l||klib.routeRender(void 0,i)}}if(!a){if(!t.forceroute&&!t.forceRoute)return!1;a=!0,e=$("<a href='"+e+"'></a>").get(0)}return a?klib.routeRender(e,t):void 0},klib.initRoutes=function(e,t){"object"==typeof e&&(t=e,e=t.context||t.scope||""),(!t||(_.merge(klib.routesOptions,t),!isKHashRouteOn&&klib.routesOptions.useHashRoute&&klib._initWindowOnHashChange(),isKHashRouteOn&&!klib.routesOptions.useHashRoute&&klib._stopWindowOnHashChange(),t.hasOwnProperty("context")||t.hasOwnProperty("scope")))&&$(e||"body").find("[data-kroute]").each(function(e,t){klib.isBlank((($(t).attr("href")||"")+"#").split("#")[1])||($(t).off("click"),$(t).on("click",function(){if(isKHashRouteOn){var e="#"+(($(t).attr("href")||"")+"#").split("#")[1].trim("#"),a=klib.getLocHash();e.equals(a)&&klib.route(this)}else klib.route(this)}),t.hasAttribute("data-kroute-default")&&klib.route(t))})},$(document).ready(function(){klib.debug=klib.urlParam("klib.debug")||klib.hashParam("klib.debug")||klib.debug,klib.reflowFoundation(),klib.initRoutes(),klib.extendBackbone(),klib.initKeyTracking(),$("[rel='kRender'],[data-render],[data-krender]").kRender()})}(this);