var _isOnOfflineValidation;var _validateAlertTemplate='<div class="errortxt break-txt" data-i18n=""></div>';var _check={required:_fnRequired,digits:_fnValidDigits,numbers:_fnValidNumbers,integer:_fnValidInteger,alphabet:_fnValidAlpha,alphanumeric:_fnValidAlphaNumeric,pattern:_fnValidPatternMatch,range:_fnValidValueRange,fixedlength:_fnValidLengths,minlength:_fnValidLengthMin,maxlength:_fnValidLengthMax,email:_fnValidEmail,url:_fnValidUrl,date:_isValidDate,cardno:_fnValidCardNo,ipv4:_fnValidIpv4,ipv6:_fnValidIpv6,ipaddress:_fnValidIpAddress,subnetmask:_fnValidSubnet,phoneUS:_fnValidPhoneUS,wordsize:_fnValidWordSize};var _offlineValidationRules={};function _fnRequired(b,c){var a=klib.getElValue(b);return _showValidateMsg(b,c,!(klib.isBlank(a)))}function _fnValidDigits(c,d){var a=$(c).val();var b=((a.length===0)||(/^\d+$/.test(a)));return _showValidateMsg(c,d,b)}function _fnValidNumbers(c,d){var a=$(c).val();var b=((a.length===0)||(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(a)));return _showValidateMsg(c,d,b)}function _fnValidInteger(c,d){var a=$(c).val();var b=((a.length===0)||(/^-?\d+$/.test(a)));return _showValidateMsg(c,d,b)}function _fnValidAlpha(c,d){var a=$(c).val();var b=((a.length===0)||!(/[^a-z]/gi.test(a)));return _showValidateMsg(c,d,b)}function _fnValidAlphaNumeric(c,d){var a=$(c).val();var b=((a.length===0)||!(/[^a-z0-9]/gi.test(a)));return _showValidateMsg(c,d,b)}function _fnValidPatternMatch(d,e){var a=$(d).val();var c=(a.length===0);if(!c){var b=new RegExp($(d).data("validatePattern"),$(d).data("validatePatternOptions").replace(/!/g,""));c=b.test(a);if($(d).data("validatePatternOptions").indexOf("!")>=0){c=!c}}return _showValidateMsg(d,e,c)}function _fnValidValueRange(d,c){var g=$(d).val();var j=(g.length===0);if(!j){j=false;if(/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(g)){var e=klib.toFloat(g);var b=(" "+($(d).data("validateRange")||"")+": ").split(":");var f=!klib.isBlank(b[0]);var i=!klib.isBlank(b[1]);var h=klib.toFloat(b[0]);var a=klib.toFloat(b[1]);if(f&&i){j=((e>=h)&&(e<=a))}else{if(f){j=(e>=h)}else{if(i){j=(e<=a)}}}}}return _showValidateMsg(d,c,j)}function _fnValidLengthMin(d,e){var b=$(d).val();var a=klib.toInt($(d).attr("minlength"));var c=(b.length>=a);return _showValidateMsg(d,e,c)}function _fnValidLengthMax(d,e){var b=$(d).val();var a=klib.toInt($(d).attr("maxlength"));var c=(b.length<=a);return _showValidateMsg(d,e,c)}function _fnValidLengths(f,g){var d=$(f).val();var c=d.length;var b=klib.toInt($(f).attr("minlength"));var a=klib.toInt($(f).attr("maxlength"));var e=((c>=b)&&(c<=a));return _showValidateMsg(f,g,e)}function _fnValidWordSize(e,f){var a=$(e).val();var b=_.max(_.map((""+a).replace(/[-\n]/g," ").split(" "),function(g){return g.length}));var d=klib.toInt($(e).data("validWordSize"))||20;var c=(b<=d);return _showValidateMsg(e,f,c)}function _fnValidEmail(c,d){var a=$(c).val();var b=(a.length===0);if(!b){b=((/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(a)||/[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/i.test(a))&&/[a-z0-9]/i.test((a[a.length-1])))}return _showValidateMsg(c,d,b)}function _fnValidUrl(c,d){var a=$(c).val();var b=(a.length===0);if(!b){b=/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(a)}return _showValidateMsg(c,d,b)}function _isValidDate(i,c){var j=$(i).val();var o=(j.length===0);if(!o){o=false;var e=["","JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"];var k=["","JANUARY","FEBRUARY","MARCH","APRIL","MAY","JUNE","JULY","AUGUST","SEPTEMBER","OCTOBER","NOVEMBER","DECEMBER"];var a=$(i).data("validateFormat")||"YMD";var f="^\\d{1,2}[\\/\\-\\.]\\d{1,2}[\\/\\-\\.]\\d{4}$";var g,d,m,l;var n=j.replace(/[^a-z]/gi,"");if(n){l=_.indexOf(e,n.toUpperCase());if(l<=0){l=_.indexOf(k,n.toUpperCase())}if(l>0){j=j.replace(new RegExp(n,"gi"),l)}}j=j.replace(/[^0-9]/g," ").normalizeStr().replace(/ /g,"/");var h=j.split("/");switch(a.toUpperCase()){case"YMD":f="^\\d{4}[\\/\\-\\.]\\d{1,2}[\\/\\-\\.]\\d{1,2}$";g=h[0];d=h[1];m=h[2];break;case"MDY":d=h[0];m=h[1];g=h[2];break;case"DMY":m=h[0];d=h[1];g=h[2];break}if((new RegExp(f,"")).test(j)){m=parseInt(m,10);d=parseInt(d,10);g=parseInt(g,10);var b=new Date(g,d-1,m);o=((b.getFullYear()===g)&&(b.getMonth()===d-1)&&(b.getDate()===m))}}return _showValidateMsg(i,c,o)}function _fnValidCardNo(e,b){var f=$(e).val();var i=(f.length===0);if(!i){if(/[^0-9 \-]+/.test(f)){i=false}else{var g=0,d=0,c=false;var j=f.replace(/\D/g,"");for(var a=j.length-1;a>=0;a--){var h=j.charAt(a);d=parseInt(h,10);if(c){if((d*=2)>9){d-=9}}g+=d;c=!c}i=((g%10)===0)}}return _showValidateMsg(e,b,i)}function _fnValidIpv4(c,d){var a=$(c).val();var b=(a.length===0);if(!b){b=((/^(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)\.(25[0-5]|2[0-4]\d|[01]?\d\d?)$/i.test(a))&&(_.every(a.split("."),function(e){return((e.length>1)?(!e.beginsWith("0")):true)})))}_showValidateMsg(c,d,b)}function _fnValidIpv6(c,d){var a=$(c).val();var b=(a.length===0);if(!b){b=/^((([0-9A-Fa-f]{1,4}:){7}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}:[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){5}:([0-9A-Fa-f]{1,4}:)?[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){4}:([0-9A-Fa-f]{1,4}:){0,2}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){3}:([0-9A-Fa-f]{1,4}:){0,3}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){2}:([0-9A-Fa-f]{1,4}:){0,4}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){6}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(([0-9A-Fa-f]{1,4}:){0,5}:((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|(::([0-9A-Fa-f]{1,4}:){0,5}((\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b)\.){3}(\b((25[0-5])|(1\d{2})|(2[0-4]\d)|(\d{1,2}))\b))|([0-9A-Fa-f]{1,4}::([0-9A-Fa-f]{1,4}:){0,5}[0-9A-Fa-f]{1,4})|(::([0-9A-Fa-f]{1,4}:){0,6}[0-9A-Fa-f]{1,4})|(([0-9A-Fa-f]{1,4}:){1,7}:))$/i.test(a)}_showValidateMsg(c,d,b)}function _fnValidIpAddress(d,a){var g=$(d).val();var j=(g.length===0);if(!j){var e=g;var h=(klib.toInt($(d).data("validateIpaddressOctates")||4))-1;var i=new RegExp("^(([01]?[0-9]?[0-9]|2([0-4][0-9]|5[0-5]))\\.){"+h+"}([01]?[0-9]?[0-9]|2([0-4][0-9]|5[0-5]))$","g");j=((i.test(e))&&(_.every(e.split("."),function(k){return((k.length>1)?(!k.beginsWith("0")):true)})));_showValidateMsg(d,a,j);var b=$(d).data("validateIpaddressClass");if((j)&&(b)){var c=e.split(".");var f={A:{oct1:{B:0,E:127},oct2:{B:0,E:256},oct3:{B:0,E:256},oct4:{B:1,E:255}},B:{oct1:{B:127,E:192},oct2:{B:1,E:256},oct3:{B:0,E:256},oct4:{B:0,E:255}},C:{oct1:{B:191,E:224},oct2:{B:0,E:256},oct3:{B:1,E:256},oct4:{B:1,E:255}},D:{oct1:{B:223,E:240},oct2:{B:0,E:256},oct3:{B:0,E:256},oct4:{B:0,E:256}},E:{oct1:{B:239,E:255},oct2:{B:0,E:256},oct3:{B:0,E:256},oct4:{B:0,E:255}}};j=((c[0]*1>f[b].oct1.B)&&(c[0]*1<f[b].oct1.E))?(((c[1]*1>=f[b].oct2.B)&&(c[1]*1<f[b].oct2.E))?(((c[2]*1>=f[b].oct3.B)&&(c[2]*1<f[b].oct3.E))?(((c[3]*1>f[b].oct4.B)&&(c[3]*1<f[b].oct4.E))?true:false):false):false):false;_showValidateMsg(d,a,j)}}return j}function _fnValidSubnet(d,e){var b=$(d).val();var c=(b.length===0);if(!c){var a=new RegExp("^((128|192|224|240|248|252|254)\\.0\\.0\\.0)|(255\\.(((0|128|192|224|240|248|252|254)\\.0\\.0)|(255\\.(((0|128|192|224|240|248|252|254)\\.0)|255\\.(0|128|192|224|240|248|252|254)))))$");c=((a.test(b))&&(_.every(b.split("."),function(f){return((f.length>1)?(!f.beginsWith("0")):true)})))}return _showValidateMsg(d,e,c)}function _fnValidPhoneUS(c,d){var a=$(c).val();var b=(a.length===0);if(!b){b=(a.length>9&&a.match(/^(\+?1-?)?(\([2-9]\d{2}\)|[2-9]\d{2})-?[2-9]\d{2}-?\d{4}$/))}return _showValidateMsg(c,d,b)}function _showValidateMsg(e,f,d,a){f=f||"";if((arguments.length>2)&&_.isString(d)){a=d}if((arguments.length>2)&&_.isBoolean(d)&&(d)){f=""}a=a||_validateAlertTemplate;e=$($(e).data("validateMsgEl")||e).get(0);var c=$(e).next();var g="";if(($(c).attr("class"))===($(a).attr("class"))){if(f.beginsWith("i18n:","i")){var b=f.replace(/i18n:/gi,"");g="{html:'"+b+"'}";f=$.i18n.prop(b)}if(!_isOnOfflineValidation){$(c).data("i18n",g);$(c).html(f)}}else{if(!klib.isBlank(f)){$(a).insertAfter($(e));_showValidateMsg(e,f,d,a)}}return d}function _clearValidateMsg(a){_showValidateMsg(a);return true}klib.initDataValidation=function(a){var j=function(m){m=m||{};_.each(_.keys(m),function(n){if(n.indexOf("_")>0){_.each(n.split("_"),function(o){if(m[o]){if(_.isArray(m[o])){m[o].push(m[n])}else{m[o]=[m[o],m[n]]}}else{m[o]=[m[n]]}});delete m[n]}});return m};a=a||"body";var h=$(a);var c=h.data("validateElFilter")||"";var k=j(klib.toJSON(h.data("validateCommon")||"{}"));klib.console.log(_.keys(k));var l,f,g,b,e;var i=h.data("offlineValidationStoreKey")||"";var d=(!klib.isBlank(i));if(d){_offlineValidationRules[i]={rules:{}}}h.find(c+"[data-validate]").each(function(p,s){var n=$(s).prop("id");var q={};var t=$(s).data("validate");if(t&&t.indexOf("{")<0){var r=($(s).data("validateEvents")||"onBlur").replace(/[^a-z]/gi," ").normalizeStr().replace(/ /g,"_");var o=",offline:"+($(s).data("validateOffline")||"false");var m="{fn:"+(t.replace(/[,;]/," ").normalizeStr().replace(/ /g,o+"},{fn:"))+o+"}";t="{"+r+":["+m+"]}"}q=j(klib.toJSON(t));klib.console.log(t);_.each(_.keys(k),function(v){var u=k[v];if(!_.isArray(u)){u=[u]}_.each(u,function(w){l=true;f="<";b=w.offline||false;g=false;if(w.el){var y=w.el.replace(/ /g,"").split(",");var z=w.el.replace(/[< >!]/g,"").split(",");var x=_.indexOf(z,n);l=(x>=0);if(l){f=(y[x].indexOf(">")>=0)?">":"<";g=(y[x].indexOf("!")>=0)}}else{if(w.ex){l=(_.indexOf(w.ex.replace(/[< >!]/g,"").split(","),n)<0)}}if(l){e=_.omit(w,["el","ex"]);if(g){e=_.extend(e,{offline:(!b)})}if(!q[v]){q[v]=[]}q[v]=(f==="<")?_.union([e],q[v]):_.union(q[v],[e])}})});_.each(_.keys(q),function(u){var v=((u.substring(2,3)).toLowerCase())+(u.substring(3));klib.console.log("settingup event on["+v+"]...");if(!_.isArray(q[u])){q[u]=[q[u]]}if(d){_.each(q[u],function(w){if(w.offline){if(!_offlineValidationRules[i].rules[n]){_offlineValidationRules[i].rules[n]=[]}if(_.indexOf(_offlineValidationRules[i].rules[n],w.fn)<0){_offlineValidationRules[i].rules[n].push(w.fn)}}})}$(s).on(v,function(){_.every(q[u],function(w){if(_.isArray(w)){return _.every(w,function(x){return(x.fn(s,(x.msg||$(s).data("validateMsg")||"")))})}else{return(w.fn(s,(w.msg||$(s).data("validateMsg")||"")))}})})})})};klib.doDataValidation=function(b){var d=(b.replace(/#/g,""));var h="#"+d;var a=$(h);var c={};if(_offlineValidationRules[d]){var f=_offlineValidationRules[d].rules;var e=function(i){var j=a.find("#"+i);var k=(klib.toBoolean(j.data("ignoreValidationIfInvisible"))&&!(j.is(":visible")));if(!k){k=_.every(f[i],function(m){var l=m(j);if(!l){c={errcode:2,el:j,fn:m}}return l})}return k};if($.isEmptyObject(f)){c={errcode:1,errmsg:"Rules not found in scope ["+b+"]."}}else{_isOnOfflineValidation=true;var g=_.every(_.keys(f),function(i){return(e(i))});_isOnOfflineValidation=false}}else{c={errcode:1,errmsg:"Scope not found."}}return(c)};